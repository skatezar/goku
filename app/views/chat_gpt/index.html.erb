<h1>ChatGPT</h1>

<head>
  <title>ChatGPT</title>
  <%= csrf_meta_tags %>
</head>

<form id="chat-form">
  <textarea id="input" rows="5" cols="50"></textarea>
  <br>
  <button id="submit-button" type="submit">Submit</button>
</form>

<div id="response"></div>

<script>
  document.getElementById("chat-form").addEventListener("submit", function(event) {
    event.preventDefault();
    var input = document.getElementById("input").value;
    generateResponse(input);
  });

  function generateResponse(input) {
    var xhr = new XMLHttpRequest();
    xhr.open("POST", "/chat_gpt/generate_response", true);
    xhr.setRequestHeader("Content-Type", "application/json");
    xhr.setRequestHeader("X-CSRF-Token", getCSRFToken());

    xhr.onload = function() {
      if (xhr.status === 200) {
        var response = JSON.parse(xhr.responseText).response;
        document.getElementById("response").innerText = response;
      } else {
        console.log("Request failed with status:", xhr.status);
      }
    };

    xhr.onerror = function() {
      console.log("Request failed");
    };

    xhr.send(JSON.stringify({ input: input }));
  }

  function getCSRFToken() {
    var metaTags = document.getElementsByTagName("meta");
    for (var i = 0; i < metaTags.length; i++) {
      if (metaTags[i].getAttribute("name") === "csrf-token") {
        return metaTags[i].getAttribute("content");
      }
    }
    return null;
  }
</script>
